<script>
/**
 * Converts an ASCII string to a hexadecimal string.
 * @param {string} ascii - The ASCII string (e.g., "Hello").
 * @returns {string} - The corresponding hexadecimal string (e.g., "48656c6c6f").
 */
function asciiToHex(ascii) {
    if (typeof ascii !== 'string') {
        throw new TypeError("Input must be a string.");
    }

    let hex = '';
    for (let i = 0; i < ascii.length; i++) {
        const hexChar = ascii.charCodeAt(i).toString(16);
        hex += hexChar.padStart(2, '0'); // Ensures each byte is two characters long
    }
    return hex;
}

document.addEventListener('DOMContentLoaded', () => {
    const urlParams = new URLSearchParams(window.location.search);
    const r = urlParams.get('r');

    // Check if 'r' exists
    if (!r) {
        alert('Missing "r" parameter in the URL.');
        return; // Prevent further execution if 'r' is missing
    }

    // Get current date components
    const today = new Date();
    const year = today.getFullYear();
    const month = today.getMonth() + 1; // Months are 0-indexed, so no need for padding
    const day = today.getDate(); // No padding for single-digit days
    const hour = today.getHours(); // No padding for single-digit hours

    // Concatenate them into a single string (e.g., "2025-5-21-15")
    const dateStr = year + month + day + hour;

    // Convert to hex (assuming asciiToHex is a function you have)
    var g = asciiToHex(dateStr);

    // Log the URL to check its correctness
    const redirectUrl = `https://scratch.mit.edu/projects/${r}/?SV=${g}`;
    alert('Redirecting to: ', redirectUrl);

    // Redirect
    window.location = redirectUrl;
});
</script>
